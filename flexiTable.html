<!-- flexiTable.html -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Flexible Table with Dynamic Filters</title>
    <link rel="stylesheet" href="flexiTable.css">

</head>

<body>
    <!-- Dropdown for selecting the data method -->
    <select id="dataFileSelector">
        <option value="intervalsByEntity">Intervals by Entity</option>
        <option value="intervalsByUser">Intervals by User</option>
        <option value="totalsByEntity">Totals by Entity</option>
        <option value="totalsByUser">Totals by User</option>
    </select>

    <div id="filtersDiv"></div>
    <div id="tableContainer" style="width: 80%;"></div>

    <script>var flexiTable;//debugging</script>

    <script type="module">
        import { FlexiTable } from './flexiTable.js';
        import { FilterManager } from './filterManager.js';
        import responseResourceAnalysis from './tests/dataSamples/responseResourceAnalysis.js';
        import { EffortTransformer } from './effortTransformer.js';

        const effortTransformer = new EffortTransformer(responseResourceAnalysis);
        const dataFileSelector = document.getElementById('dataFileSelector');
        const tableContainer = document.getElementById('tableContainer');

        const defaultDataMethod = 'transformToIntervalsByEntity';
        dataFileSelector.value = localStorage.getItem('selectedDataMethod') || defaultDataMethod;

        let flexiTable; // Declare variable outside to have broader scope
        let filterManager; // Declare variable outside to delay its creation

        document.addEventListener('DOMContentLoaded', () => {
            changeDataMethod(); // Initialize everything in this method
            dataFileSelector.addEventListener('change', changeDataMethod);
        });

        async function changeDataMethod() {
            const selectedMethod = dataFileSelector.value;
            localStorage.setItem('selectedDataMethod', selectedMethod);

            let data;
            switch (selectedMethod) {
                case 'intervalsByEntity':
                    data = effortTransformer.transformToIntervalsByEntity();
                    break;
                case 'intervalsByUser':
                    data = effortTransformer.transformToIntervalsByUser();
                    break;
                case 'totalsByEntity':
                    data = effortTransformer.transformToTotalsByEntity();
                    break;
                case 'totalsByUser':
                    data = effortTransformer.transformToTotalsByUser();
                    break;
            }

            tableContainer.innerHTML = ''; // Clear previous table contents

            flexiTable = new FlexiTable('tableContainer', data); // Re-create the flexiTable instance here

            window.flexiTable = flexiTable; // Assign to window object to access from outside
            // Initialize filterManager here after flexiTable has been instantiated
            // empty the filtersDiv before creating a new filterManager
            document.getElementById('filtersDiv').innerHTML = '';
            filterManager = new FilterManager('filtersDiv', filters => flexiTable.updateFilters(filters), {
                project: true, workItem: true, user: true
            });

        }
    </script>

</body>


</html>