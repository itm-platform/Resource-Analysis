<!-- flexibleTable.html -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Flexible Table with Dynamic Filters</title>
    <style>
        .clickable {
            cursor: pointer;
        }

        .indent {
            padding-left: 20px;
        }
    </style>
</head>

<body>
    <div id="filtersDiv">
        <!-- Dropdown for selecting the data file -->
        <select id="dataFileSelector">
            <option value="intervalsByEntity">Intervals by Entity</option>
            <option value="TotalsByEntity">Totals by Entity</option>
        </select>
    </div>
    <div id="tableContainer" style="width: 80%;"></div>

    <script type="module">
        import { FlexibleTable } from './flexibleTable.js';
        import { FilterManager } from './filterManager.js';
    
        const dataFileSelector = document.getElementById('dataFileSelector');
        let currentDataModule = './dataSamples/intervalsByEntity.js'; // Default data module
    
        // Initialize FilterManager outside the data loading function
        let options = {
            filters: {
                rowFilters: { Program: true, Project: true, Task: true, User: true },
            }
        };
    
        let filterManager = new FilterManager('filtersDiv', filters => {}, options.filters.rowFilters);
        let flexibleTable;
    
        document.addEventListener('DOMContentLoaded', async () => {
            await loadDataAndInitializeTable(currentDataModule);
    
            dataFileSelector.addEventListener('change', async (event) => {
                const selectedOption = event.target.value;
                currentDataModule = `./dataSamples/${selectedOption}.js`;
                await loadDataAndInitializeTable(currentDataModule);
            });
        });
    
        async function loadDataAndInitializeTable(dataModulePath) {
            const { default: data } = await import(dataModulePath);
    
            // Clear existing content in the tableContainer
            const tableContainer = document.getElementById('tableContainer');
            while (tableContainer.firstChild) {
                tableContainer.removeChild(tableContainer.firstChild);
            }
    
            // Reuse filterManager and only reset if necessary
            // This place is where you might want to update or reset filters based on new data
    
            // Initialize or reinitialize the FlexibleTable as needed
            flexibleTable = new FlexibleTable('tableContainer', data, filterManager.filters);
    
            filterManager.onFilterChangeCallback = (filters) => {
                flexibleTable.updateFilters(filters);
            };
        }
    </script>
    
</body>



</html>